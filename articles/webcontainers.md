---
title: "WebContainersã§ä½œã‚‹ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼é–‹ç™ºç’°å¢ƒ"
emoji: "ğŸ‘¨â€ğŸ’»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react"]
published: true
---

## WebContainersã¨ã¯

ã¿ãªã•ã‚“ã€WebContainersã‚’ã”å­˜çŸ¥ã§ã—ã‚‡ã†ã‹ï¼Ÿ
WebContainersã¯StackBlitzãŒé–‹ç™ºã—ã¦ã„ã‚‹ã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ä¸Šã§é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
ãªã‚“ã¨ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã ã‘ã§Node.jsã‚„Next.jsãªã©ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå‹•ã‹ã›ã¦ã—ã¾ã„ã¾ã™ã€‚

https://webcontainers.io/

ã™ã§ã«ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦Svelteã®PlaygroundãŒç”¨æ„ã•ã‚Œã¦ã„ãŸã‚Šã—ã¾ã™ã€‚

https://learn.svelte.dev/

## ç¾åœ¨WebContainersã‚’ä½¿ã£ã¦ä½œã£ã¦ã„ã‚‹ã‚‚ã®

ç¾åœ¨ã€ä»¥ä¸‹ã®å‹•ç”»ã®ã‚ˆã†ãªãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã ã‘ã§Next.jsã‚„Reactã‚’ä½¿ã£ãŸé–‹ç™ºãŒã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ä½œã£ã¦ã„ã¾ã™ã€‚

https://www.youtube.com/watch?v=3cqsoOvgv68

ã“ã“ã«é–‹ç™ºä¸­ã®ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã®ãƒªãƒ³ã‚¯ã‚’è²¼ã£ã¦ãŠãã¾ã™ã€‚

https://browser-editor.vercel.app/


ã™ã§ã«ã“ã®ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã§ä»¥ä¸‹ã®ã‚ˆã†ãªã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

- ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã€å‰Šé™¤ã€ãƒªãƒãƒ¼ãƒ 
- ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®æ“ä½œï¼ˆjshï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†ï¼ˆVSCodeã®ã‚ˆã†ãªã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ï¼‰
- ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§ã®å®Ÿè¡Œçµæœã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼

ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½œã‚Šåˆ‡ã£ãŸã‚‰ç¾åœ¨é‹å–¶ã—ã¦ã„ã‚‹Webå­¦ç¿’ã‚µãƒ¼ãƒ“ã‚¹mosyaã«ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦Reactã‚’å­¦ç¿’ã§ãã‚‹æ–°ãŸãªãƒ—ãƒ©ãƒ³ã‚’ç”¨æ„ã—ã‚ˆã†ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

https://mosya.dev/

## WebContainersã‚’ä½¿ã£ãŸé–‹ç™ºç’°å¢ƒã®ä½œã‚Šæ–¹

ä»Šå›ã¯ã“ã®WebContainersã‚’ä½¿ã£ãŸé–‹ç™ºç’°å¢ƒã®ä½œã‚Šæ–¹ã‚’ç°¡å˜ã«è§£èª¬ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

### WebContainersã®èµ·å‹•

ã¾ãšã€WebContainersã®èµ·å‹•æ–¹æ³•ã«ã¤ã„ã¦ã§ã™ã€‚

WebContainersã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦èµ·å‹•ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```ts
import { WebContainer } from "@webcontainer/api";

const container = await WebContainer.boot();
```

### ãƒ•ã‚¡ã‚¤ãƒ«ãƒ„ãƒªãƒ¼ã¨ã®ç´ä»˜ã‘

ä»¥ä¸‹ã®ã‚ˆã†ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹ã“ã¨ã§WebContainersã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```ts
const files = {
  // This is a directory - provide its name as a key
  src: {
    // Because it's a directory, add the "directory" key
    directory: {
      // This is a file - provide its path as a key:
      'main.js': {
        // Because it's a file, add the "file" key
        file: {
          contents: `
            console.log('Hello from WebContainers!')
          `,
        },
      },
      // This is another file inside the same folder
      'main.css': {
        // Because it's a file, add the "file" key
        file: {
          contents: `
            body {
              margin: 0;
            }
          `,
        },
      },
    },
  },
  // This is a file outside the folder
  'package.json': {
    /* Omitted for brevity */
  },
  // This is another file outside the folder
  'index.html': {
    /* Omitted for brevity */
  },
};
container.mount(files);
```

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å ´åˆã¯ãã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ¼ã®ã‚­ãƒ¼åã«å¯¾ã—ã¦ã•ã‚‰ã«`directory`ã¨ã„ã†ã‚­ãƒ¼ã‚’ä¸‹ã«è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šè‰²ã€…ã¨ã‚ã‚“ã©ãã•ã„ã§ã™ã€‚

ãã“ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªé–¢æ•°ã‚’ä½œã£ã¦ã„ã¾ã™ã€‚å„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚­ãƒ¼åã®ãƒ‘ã‚¹ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ãƒ„ãƒªãƒ¼ã‚’ä½œæˆã™ã‚‹é–¢æ•°ã§ã™ã€‚

::: details filesToSystemTreeé–¢æ•°
```ts
export type Files = {
  [key: string]: {
    value: string;
    language: string;
    active?: boolean;
    hidden?: boolean;
    tabbed?: boolean;
  };
};
export function filesToSystemTree(input: Files): FileSystemTree {
  const output: FileSystemTree = {};

  for (const key in input) {
    // Remove any './' from the beginning of the key
    const adjustedKey = key.startsWith("./") ? key.slice(2) : key;

    const splitKeys = adjustedKey.split("/").filter(Boolean);

    let currentOutput = output;
    for (let i = 0; i < splitKeys.length; i++) {
      const subKey = splitKeys[i];

      // If we're at a file, assign it as file with contents
      if (i === splitKeys.length - 1) {
        currentOutput[subKey] = { file: { contents: input[key].value } };
      } else {
        // Otherwise, create a new directory if it doesn't exist
        if (!currentOutput[subKey]) {
          currentOutput[subKey] = { directory: {} };
        }

        // Move our pointer to this directory
        currentOutput = currentOutput[subKey].directory!;
      }
    }
  }

  return output;
}
```
:::

### ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

`WebContainers`ã«ã¯ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°ãŒç”¨æ„ã•ã‚Œã¦ã„ã¦ã€ã“ã‚Œã‚’ä½¿ã†ã“ã¨ã§`npm`ã‚„`yarn`ã‚’ä½¿ã£ã¦ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```ts
// Install dependencies
const installProcess = await container.spawn("npm", ["install"]);
// Wait for install command to exit
await installProcess.exit;
```

### ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã¨ã®ç´ä»˜ã‘

ã¾ãŸã€`Xterm.js`ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã‚’ä½¿ã£ã¦ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯`WebContainers`ã¨ã¨ã¦ã‚‚ç›¸æ€§ãŒã„ã„ã§ã™ã€‚

http://xtermjs.org/

ä»¥ä¸‹ã®ã‚ˆã†ã«`WebContainers`ã®ãƒ—ãƒ­ã‚»ã‚¹ã®å‡ºåŠ›ã‚’`Xterm.js`ã®å‡ºåŠ›ã«ãƒ‘ã‚¤ãƒ—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```ts
import { Terminal } from "xterm";

const terminal = new Terminal();
const installProcess = await container.spawn("npm", ["install"]);
installProcess.output.pipeTo(
  new WritableStream({
    write(data) {
      terminal.write(data);
    },
  })
);
```

ã¾ãŸåå¯¾ã«`Xterm`ã«å…¥åŠ›ãŒã‚ã£ãŸå ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦`WebContainers`ã®ãƒ—ãƒ­ã‚»ã‚¹ã«ãƒ‘ã‚¤ãƒ—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```ts
const shellProcess = await container.spawn("jsh", {
  terminal: {
    cols: terminal.cols,
    rows: terminal.rows,
  },
});
shellProcess.output.pipeTo(
  new WritableStream({
    write(data) {
      terminal.write(data);
    },
  })
);

const input = shellProcess.input.getWriter();
terminal.onData((data) => {
  input.write(data);
});
```

### ã‚¢ãƒ—ãƒªã®èµ·å‹•

æœ€å¾Œã«`WebContainers`ã‚’èµ·å‹•ã—ã¾ã™ã€‚èµ·å‹•ã™ã‚‹ã®ã¯æ™®æ®µNext.jsã‚’ä½¿ã£ã¦ã„ã‚‹æ™‚ã¨åŒã˜ã‚ˆã†ã«`npm`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦`dev`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§ã™ã€‚

```ts
const startProcess = await container.spawn("npm", ["run", "dev"]);
startProcess.output.pipeTo(
  new WritableStream({
    write(data) {
      terminal.write(data);
    },
  })
);
// Wait for `server-ready` event
return new Promise<string>((resolve) => {
  container.on("server-ready", (port, url) => {
    resolve(url);
  });
});
```

ã¾ãŸã€`container`ã®ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ãŸéš›ã«ã¯`server-ready`ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã™ã‚‹ã®ã§ã€ã“ã‚Œã‚’å¾…ã¤ã“ã¨ã§ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ãŸã“ã¨ã‚’æ¤œçŸ¥ã™ã‚‹ã“ã¨ãŒã§ãã€åŒæ™‚ã«ã‚µãƒ¼ãƒãƒ¼ã®URLã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã“ã‚Œã‚’`iframe`ã®`src`ã«æ¸¡ã™ã“ã¨ã§ã€`iframe`ã«ã‚¢ãƒ—ãƒªã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ã¨ã‚ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚

::: details ã¾ã¨ã‚

```tsx
import React, { useEffect } from "react";
import { HashLoader } from "react-spinners";
import { Terminal } from "xterm";

import type { Files } from "./types";

import { useBrowserEditor } from "./hooks/use-browser-editor";
import { transform } from "./utils/file-system";
import { getWebContainerInstance } from "./utils/webcontainer";
import { getTerminalInstance } from "./utils/terminal";

async function bootinstance(files: Files) {
  const webcontainerInstance = await getWebContainerInstance();
  await webcontainerInstance.mount(transform(files));
}

async function installDependencies(terminal: Terminal) {
  // Install dependencies
  const webcontainerInstance = await getWebContainerInstance();
  const installProcess = await webcontainerInstance.spawn("npm", ["install"]);
  installProcess.output.pipeTo(
    new WritableStream({
      write(data) {
        terminal.write(data);
      },
    })
  );
  // Wait for install command to exit
  return installProcess.exit;
}

async function startDevServer(terminal: Terminal) {
  const webcontainerInstance = await getWebContainerInstance();
  // Run `npm run start` to start the Express app
  const startProcess = await webcontainerInstance.spawn("npm", ["run", "dev"]);
  startProcess.output.pipeTo(
    new WritableStream({
      write(data) {
        terminal.write(data);
      },
    })
  );
  // Wait for `server-ready` event
  return new Promise<string>((resolve) => {
    webcontainerInstance.on("server-ready", (port, url) => {
      resolve(url);
    });
  });
}

async function startShell(terminal: Terminal) {
  const webcontainerInstance = await getWebContainerInstance();
  const shellProcess = await webcontainerInstance.spawn("jsh", {
    terminal: {
      cols: terminal.cols,
      rows: terminal.rows,
    },
  });
  shellProcess.output.pipeTo(
    new WritableStream({
      write(data) {
        terminal.write(data);
      },
    })
  );

  const input = shellProcess.input.getWriter();
  terminal.onData((data) => {
    input.write(data);
  });

  // shellProcess.

  return shellProcess;
}

async function run(files: Files) {
  const terminal = getTerminalInstance();
  await bootinstance(files);
  await installDependencies(terminal);
  const url = await startDevServer(terminal);
  await startShell(terminal);
  return url;
}

export const Preview = () => {
  const { files } = useBrowserEditor();
  const [url, setUrl] = React.useState("");
  const [boot, setBoot] = React.useState(false);
  useEffect(() => {
    if (boot || !files || Object.keys(files).length === 0) {
      return;
    }
    setBoot(true);
    run(files).then((url) => {
      setUrl(url);
    });
  }, [files]);

  return (
    <div className="rounded-md flex-1 h-full overflow-hidden">
      <div className="w-full h-11 rounded-t-lg bg-gray-200 flex justify-start items-center space-x-1.5 px-3">
        <span className="w-3 h-3 rounded-full bg-red-400"></span>
        <span className="w-3 h-3 rounded-full bg-yellow-400"></span>
        <span className="w-3 h-3 rounded-full bg-green-400"></span>
      </div>
      {url && (
        <iframe
          src={url}
          sandbox="allow-scripts allow-same-origin allow-popups-to-escape-sandbox allow-popups"
          className="h-full bg-gray-50 p-2 w-full"
        ></iframe>
      )}
      {!url && (
        <div className="grid place-items-center h-full w-full">
          <HashLoader color="#36d7b7" />
        </div>
      )}
    </div>
  );
};
```
:::

## ãƒ•ã‚¡ã‚¤ãƒ«ãƒ„ãƒªãƒ¼ã®å¯è¦–åŒ–

æ¬¡ã«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ„ãƒªãƒ¼ã®å¯è¦–åŒ–ã§ã™ã€‚
ãƒ•ã‚¡ã‚¤ãƒ«ãƒ„ãƒªãƒ¼ã®å¯è¦–åŒ–ã«ã¯`@sinm/react-file-tree`ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€æ‹¡å¼µå­ã«å¿œã˜ã¦ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤ºã—ã¦ãã‚Œã¦ã¨ã¦ã‚‚ã„ã„æ„Ÿã˜ã§ã™ï¼

![](https://storage.googleapis.com/zenn-user-upload/188fdb8dbf23-20230810.png)

ã‚¹ã‚¿ãƒ¼æ•°ã¯2023å¹´8/10ç¾åœ¨ã€ãŸã£ãŸ3ã¤ã—ã‹ãªã„ã®ã§ã™ãŒã¨ã¦ã‚‚å„ªç§€ã§ã™ï¼

https://github.com/pansinm/react-file-tree

## ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼éƒ¨åˆ†ã®å®Ÿè£…

ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã®å®Ÿè£…ã«ã¯ãŠé¦´æŸ“ã¿Monaco Editorã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚
é›£ã—ã‹ã£ãŸã®ãŒãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å‹æƒ…å ±ã¨è¡¨ç¤ºãªã®ã§ã™ãŒã€
`esm.sh`ã‹ã‚‰å‹æƒ…å ±ã‚’å¼•ã£å¼µã£ã¦ãã¦ãã‚Œã‚’`Monaco Editor`ã«æ¸¡ã™ã“ã¨ã§è§£æ±ºã—ã¾ã—ãŸã€‚

ä¾‹ãˆã°ã€`react`ã®å‹æƒ…å ±ã‚’å–å¾—ã—ãŸã„å ´åˆã¯`https://esm.sh/react`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã®`x-typescript-types`ã«å‹æƒ…å ±ã®URLãŒå…¥ã£ã¦ã„ã‚‹ã®ã§ã€ã•ã‚‰ã«ãã®URLã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§å‹æƒ…å ±ã‚’å–å¾—ã§ãã¾ã™ã€‚

```tsx
export const resolveModuleType = async (
  module: string,
): Promise<void> => {
  const res = await fetch(`https://esm.sh/${module}`);
  const dtsUrl = res.headers.get("x-typescript-types");
  if (!dtsUrl) return;
  const dts = await fetch(dtsUrl);
  const dtsText = await dts.text();
  // å–å¾—ã—ãŸå‹ã‚’Monaco Editorã«æ¸¡ã™
  monaco.languages.typescript.typescriptDefaults.addExtraLib(
    dtsText,
    `file:///node_modules/@types/${module}/index.d.ts`
  );
};

// reactã®å‹ã‚’å–å¾—
resolveModuleType("react");
```

#### Monaco Editorã§JSXã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã™ã‚‹

Monaco Editorã¯jsxã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã«æ¨™æº–ã§ç¾åœ¨ã®ã¨ã“ã‚å¯¾å¿œã—ã¦ã„ãªã„ã®ã§ã€monaco-textmateã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦jsxã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å®Ÿç¾ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/da47a9c1ac33-20230810.png)

ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ãã‚Œãã‚Œè¨€èªã«å¿œã˜ãŸãƒã‚¤ãƒ©ã‚¤ãƒˆã«å¿…è¦ãªå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚
ä»Šå›ã¯ä¾¿åˆ©ãªã®ã§VS Codeã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚

::: details JSXã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
```tsx
import { wireTmGrammars } from "monaco-editor-textmate";
import { Registry } from "monaco-textmate"; // peer dependency
import { loadWASM } from "onigasm"; // peer dependency of 'monaco-textmate'

const textmatePath =
  "https://esm.sh/githubusercontent/microsoft/vscode/main/extensions";

const registry = new Registry({
  getGrammarDefinition: async (scopeName) => {
    if (scopeName === "source.tsx") {
      const response = await fetch(
        `${textmatePath}/typescript-basics/syntaxes/TypeScriptReact.tmLanguage.json`
      );
      return {
        format: "json",
        content: await response.text(),
      };
    }
    if (scopeName === "source.ts") {
      const response = await fetch(
        `${textmatePath}/typescript-basics/syntaxes/TypeScriptReact.tmLanguage.json`
      );
      return {
        format: "json",
        content: await response.text(),
      };
    }
    if (scopeName === "source.js") {
      const response = await fetch(
        `${textmatePath}/javascript/syntaxes/JavaScriptReact.tmLanguage.json`
      );
      return {
        format: "json",
        content: await response.text(),
      };
    }
    if (scopeName === "source.jsx") {
      const response = await fetch(
        `${textmatePath}/javascript/syntaxes/JavaScriptReact.tmLanguage.json`
      );
      return {
        format: "json",
        content: await response.text(),
      };
    }
    if (scopeName === "source.css") {
      const response = await fetch(
        `${textmatePath}/css/syntaxes/css.tmLanguage.json`
      );
      return {
        format: "json",
        content: await response.text(),
      };
    }
    if (scopeName === "text.html.basic") {
      const response = await fetch(
        `${textmatePath}/html/syntaxes/html.tmLanguage.json`
      );
      return {
        format: "json",
        content: await response.text(),
      };
    }
    if (scopeName === "source.json") {
      const response = await fetch(
        `${textmatePath}/json/syntaxes/JSON.tmLanguage.json`
      );
      return {
        format: "json",
        content: await response.text(),
      };
    }
    return {
      format: "json",
      content: "",
    };
  },
});

export const initEditor = async () => {
  await loadWASM("https://esm.sh/onigasm@2.2.5/lib/onigasm.wasm");
  monaco.editor.defineTheme("myTheme", theme);
  monaco.editor.setTheme("myTheme");
  const grammers = new Map();
  grammers.set("typescript", "source.tsx");
  grammers.set("javascript", "source.jsx");
  grammers.set("css", "source.css");
  grammers.set("html", "text.html.basic");
  grammers.set("json", "source.json");
  await wireTmGrammars(monaco, registry, grammers);
};
```
:::

## ã¾ã¨ã‚

StackBlitzç¤¾ãŒé–‹ç™ºã—ãŸ`WebContainers`ã‚’ä½¿ã†ã“ã¨ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ä¸Šã§Next.jsã‚’é–‹ç™ºã§ãã‚‹ç’°å¢ƒã‚’ç°¡å˜ã«ç”¨æ„ã§ãã¾ã—ãŸã€‚
ã“ã‚Œã«`Xterm.js`ã‚„`Monaco Editor`ãªã©ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€å¯èƒ½æ€§ã¯ç„¡é™å¤§ã§ã™ã€‚
åˆå­¦è€…ã«ã¯ãªã‹ãªã‹ç’°å¢ƒæ§‹ç¯‰ã¯é›£ã—ãæŒ«æŠ˜ã—ã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚
ã“ã®ã‚ˆã†ã«ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§ç’°å¢ƒã‚’ç”¨æ„ã—ã¦ã‚ã’ã¦æ•·å±…ã‚’ä¸‹ã’ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šå¤šãã®äººãŒãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’å§‹ã‚ã‚‰ã‚Œã‚‹ãã£ã‹ã‘ã«ãªã‚‹ã¨ã„ã„ãªã¨æ€ã„ã¾ã™ã€‚

ã¾ãŸã€å­¦ç¿’ç”¨ã«é™ã‚‰ãšã€ä½œã£ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®Playgroundã‚’ç”¨æ„ã™ã‚‹ã¨ããªã©ã«ã‚‚ä½¿ãˆã‚‹ã¨æ€ã†ã®ã§ã€ãœã²è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

## ä»Šå¾Œã®èª²é¡Œ

ä»Šå¾Œã‚‚ã£ã¨ã“ã®ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã‚’ãƒ–ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—ã—ã¦ã„ã‘ãŸã‚‰ã„ã„ãªã¨è€ƒãˆã¦ã„ã¦ä»¥ä¸‹ã®ã‚ˆã†ãªæ”¹å–„ã‚„æ©Ÿèƒ½è¿½åŠ ã‚’è€ƒãˆã¦ã„ã¾ã™ã€‚

- Gité€£æº
- é–‹ã„ãŸã‚¿ãƒ–ã‚’é–‰ã˜ã‚‹
- `npm install`ãªã©ã—ãŸå¾Œã«`package.json`ã‚’æ›´æ–°ã™ã‚‹
- Prismaãªã©ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚µãƒãƒ¼ãƒˆ
- ä½œã£ãŸã‚³ãƒ¼ãƒ‰ã®å…±æœ‰ãªã©