---
title: "ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã«Chromeã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’åŸ‹ã‚è¾¼ã‚ã‚‹Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã£ã¦ã¿ãŸ"
emoji: "ğŸ“”"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react", "devtools", "chrome"]
published: true
---

ã¨ã¦ã‚‚ãƒ‹ãƒƒãƒãªç”¨é€”ã§ä½¿ãˆã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ãŒãã®å ´ã®iframeã®ãƒ‡ãƒãƒƒã‚¯ãŒã§ãã‚‹Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã£ã¦ã¿ã¾ã—ãŸï¼
ã¾ãšã¯ã“ã¡ã‚‰ã®ãƒã‚¹ãƒˆã‚’ã”è¦§ãã ã•ã„ï¼

@[tweet](https://twitter.com/steelydylan/status/1775367867648938371)

ã“ã®ãƒã‚¹ãƒˆã§ã¯Chromeã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’é–‹ã„ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªãã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼å†…ã«ç›´æ¥ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ãŒåŸ‹ã‚è¾¼ã¾ã‚Œã¦ã„ã¾ã™ï¼

ä»Šå›ã¯ã“ã®ã‚ˆã†ãªReactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã£ã¦ã¿ãŸã®ã§ã€ã©ã®ã‚ˆã†ã«ä½œã£ãŸã‹ã‚’ã”ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

## ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸

ã“ã¡ã‚‰ã®ãƒšãƒ¼ã‚¸ã§å®Ÿéš›ã«ãƒ‡ãƒ¢ã‚’è©¦ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

[https://react-embed-devtools.vercel.app/](https://react-embed-devtools.vercel.app/)

## ãªãœä½œã£ãŸã‹

Reactã‚’ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§å­¦ç¿’ã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹mosya Reactã‚’å…ˆæ—¥ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸã€‚

https://mosya.dev/react

ã“ã®ã‚µã‚¤ãƒˆã§ã¯ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ä¸Šã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ãã®å ´ã§æ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ãŒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

è©³ã—ã„é–‹ç™ºè¨˜äº‹ã¯ã“ã¡ã‚‰ã‚’ã”è¦§ãã ã•ã„ï¼

https://zenn.dev/steelydylan/articles/mosya-react-development

ãŸã ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç’°å¢ƒã§å°‘ã—ä¸ä¾¿ã ãªã¨ãŠã‚‚ã£ã¦ã„ã‚‹ã¨ã“ã‚ãŒã‚ã‚Šã¾ã—ãŸã€‚
ãã‚ŒãŒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼(`iframe`)å†…ã®è¦ç´ ã®æ¤œè¨¼ã§ã™ï¼
æ™®é€šã«ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’é–‹ã„ã¦è¦ç´ ã‚’æ¤œè¨¼ã—ã¦ã‚‚ã‚‰ã£ã¦ã‚‚ã„ã„ã®ã§ã™ãŒã€
ãã‚Œã ã¨ã€**æœ¬æ¥å­¦ç¿’ã«é–¢ä¿‚ã®ãªã„mosyaæœ¬ä½“ã®è¦ç´ ã‚„ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã†ã¨ã„ã†å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸ**ã€‚

ãã“ã§ã€ãƒ¬ãƒƒã‚¹ãƒ³ã®å†…å®¹ã«åˆã‚ã›ã¦ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã¨ãŒã§ãã‚Œã°ã€å­¦ç¿’è€…ã«ã¨ã£ã¦ã‚‚ä½¿ã„ã‚„ã™ã„ç’°å¢ƒã‚’æä¾›ã§ãã‚‹ã®ã§ã¯ãªã„ã‹ã¨è€ƒãˆã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/9bb013d9bbac-20240410.png)

## Chiiã¨Chobitsuã‚’ä½¿ã£ãŸReactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é–‹ç™º

ä»Šå›ã®Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é–‹ç™ºã«ã¯Chiiã¨Chobitsuã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ã¾ã—ãŸã€‚

### Chii

Chromeã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§ä½¿ãŠã†ã¨ã„ã†è©¦ã¿ã¯Chiiã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§è¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã‚Œã¯æœ¬æ¥ã€**ãƒªãƒ¢ãƒ¼ãƒˆã«ã‚ã‚‹ãƒ‡ãƒã‚¤ã‚¹ã®è¦ç´ ã‚’æ¤œè¨¼ã—ãŸã‚Šã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ãŸã‚Šã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™**ã€‚
ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã“ã¨ã§iOSã®Safariãªã©æ¤œè¨¼ã—ã«ãã„ãƒ‡ãƒã‚¤ã‚¹ã§ã‚‚ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚

https://github.com/liriliri/chii

### Chobitsu

ä¸€æ–¹ã§åŒä½œè€…ãŒé–‹ç™ºã—ã¦ã„ã‚‹ã€Chobitsuã¯å…ˆã»ã©ã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã«å‘½ä»¤ã‚’é€ã‚‹ã“ã¨ãŒã§ãã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚ã‚Šã¾ã™ï¼

ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¯

> Chrome devtools protocol JavaScript implementation.


ã¨ã„ã†èª¬æ˜ãŒã•ã‚Œã¦ã„ã¾ã™ã€‚

ã™ãªã‚ã¡ã€ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã“ã¨ã§ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã«å¯¾ã—ã¦å‘½ä»¤ã‚’é€ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã™ï¼

https://github.com/liriliri/chobitsu

ä¾‹ãˆã°ã€ä¸‹ã®ã‚ˆã†ãªãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å…¨å‰Šé™¤ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```js
chobitsu.sendRawMessage(JSON.stringify({
  id: 1,  
  method: 'DOMStorage.clear',
  params: {
    storageId: {
      isLocalStorage: true,
      securityOrigin: 'http://example.com'
    }
  }
}));
```

### iframeã®æ¤œè¨¼ã¨ã—ã¦Chiiã¨Chobitsuã‚’ä½¿ã†

ã“ã®äºŒã¤ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å­˜åœ¨ã‚’çŸ¥ã£ã¦ã€æœ¬æ¥ã€`Chii`ã¯ãƒªãƒ¢ãƒ¼ãƒˆã®ãƒ‡ãƒã‚¤ã‚¹ã‚’ãƒ‡ãƒãƒƒã‚¯ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ãŒã€ã“ã®`Chobitsu`ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ãƒªãƒ¢ãƒ¼ãƒˆã§ãªãã¦ã‚‚ãã®å ´ã®iframeã®ãƒ‡ãƒãƒƒã‚¯ã«ã‚‚ä½¿ãˆã‚‹ã®ã§ã¯ã¨åƒ•ã¯è€ƒãˆã¾ã—ãŸã€‚

ç‰¹ã«ã€ãã®å ´ã§iframeã®æ¤œè¨¼ãŒã§ãã‚‹ã¨**Playgroundã‚„ã“ã®ã‚ˆã†ãªãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å­¦ç¿’ã‚µãƒ¼ãƒ“ã‚¹ã«ã¯ã¨ã¦ã‚‚ä¾¿åˆ©ãã†ã§ã™ï¼**

### ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«å´

ã¾ãšã€ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«å´ã‚’`Chii`ã‚’ä½¿ã£ã¦ä½œæˆã—ã¾ã—ãŸã€‚
ä»¥ä¸‹ã®ã‚ˆã†ã«`Chii`ã‚’å‹•ã‹ã™ã®ã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä¸€è‰²HTMLã§èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚

```html
<meta name="referrer" content="no-referrer">
<script src="
https://cdn.jsdelivr.net/npm/requestidlecallback-polyfill@1.0.2/index.min.js
"></script>
<script src="https://unpkg.com/@ungap/custom-elements/es.js"></script>
<script type="module" src="https://cdn.jsdelivr.net/npm/chii@1.8.0/public/front_end/entrypoints/chii_app/chii_app.js"></script>
<script>
```

ã“ã‚Œã‚’iframeå†…ã«èª­ã¿è¾¼ã‚€ã“ã¨ã§ã€ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚
ãŸã ã€srcDocå±æ€§ã¨ã—ã¦èª­ã¿è¾¼ã‚€ã¨ã†ã¾ããƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ãŒå‹•ã‹ãªã„ã®ã§ã€ä½œæˆã—ãŸHTMLã‚’**Blob**ã¨ã—ã¦URLã«å¤‰æ›ã—ã¦iframeã«èª­ã¿è¾¼ã‚€ã“ã¨ã§ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

```ts
export function useDevtools() {
  const [url, setUrl] = useState<string | null>(null);
  useEffect(() => {
    const devtoolsRawUrl = URL.createObjectURL(
      new Blob([devToolHTML], { type: "text/html" })
    );
    setUrl(devtoolsRawUrl);
    return () => URL.revokeObjectURL(devtoolsRawUrl);
  }, []);

  return `${url}#?embedded=${encodeURIComponent(location.origin)}`;
}
```

### ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã®iframeå´

æ¬¡ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã®iframeã«ã¯å¿…ãš`Chobitsu`ã‹ã‚‰ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã«å‘ã‘ã¦å‘½ä»¤ã‚’é€ã‚‹ãŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èª­ã¿è¾¼ã¿ã¾ã™ï¼
å¤§ä½“ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã™ï¼

::: details åŸ‹ã‚è¾¼ã¿ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```html
<script src="https://cdn.jsdelivr.net/npm/chobitsu"></script>
<script type="module">
  const sendToDevtools = (message) => {
    window.parent.postMessage(JSON.stringify(message), '*');
  };
  let id = 0;
  const sendToChobitsu = (message) => {
    message.id = 'tmp' + ++id;
    chobitsu.sendRawMessage(JSON.stringify(message));
  };
  chobitsu.setOnMessage((message) => {
    if (message.includes('"id":"tmp')) return;
    window.parent.postMessage(message, '*');
  });
  const firstLocation = location.href
  window.addEventListener('message', ({ data }) => {
    try {
      const { event, value } = data;
      if (event === 'DEV') {
        chobitsu.sendRawMessage(data.data);
      } else if (event === 'LOADED') {
        sendToDevtools({
          method: 'Page.frameNavigated',
          params: {
            frame: {
              id: '1',
              mimeType: 'text/html',
              securityOrigin: location.origin,
              url: firstLocation,
            },
            type: 'Navigation',
          },
        });
        sendToChobitsu({ method: 'Network.enable' });
        sendToDevtools({ method: 'Runtime.executionContextsCleared' });
        sendToChobitsu({ method: 'Runtime.enable' });
        sendToChobitsu({ method: 'Debugger.enable' });
        sendToChobitsu({ method: 'DOMStorage.enable' });
        sendToChobitsu({ method: 'DOM.enable' });
        sendToChobitsu({ method: 'CSS.enable' });
        sendToChobitsu({ method: 'Overlay.enable' });
        sendToDevtools({ method: 'DOM.documentUpdated' });
      }
    } catch (e) {
      console.error(e);
    }
  });
</script>
```
:::

### ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨DevToolsã‚’æŒã¤ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§ã¯Devtoolsã‹ã‚‰æ¥ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å´ã«æµã™å‡¦ç†ã¨Devtoolsã‹ã‚‰æ¥ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å´ã«æµã™å‡¦ç†ã‚’ã—ã¾ã™ã€‚
ã¤ã¾ã‚ŠäºŒã¤ã®iframeã®ä»²ä»‹å½¹ã§ã™ï¼

```ts
const messageListener = (event: MessageEvent) => {
  // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’Devtoolsã«é€ä¿¡
  if (event.source === iframeRef.current?.contentWindow) {
    devtoolsIframeRef.current?.contentWindow?.postMessage(event.data, "*");
  }
  // Devtoolsã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«é€ä¿¡
  if (event.source === devtoolsIframeRef.current?.contentWindow) {
    iframeRef.current?.contentWindow?.postMessage(
      { event: "DEV", data: event.data },
      "*"
    );
  }
};
window.addEventListener("message", messageListener);
```

## ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåŒ–ã—ãŸ

ã“ã‚Œã‚‰ã®å‡¦ç†ã‚’ã¾ã¨ã‚ã¦ä»Šå›`react-embed-devtools`ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦å…¬é–‹ã—ã¾ã—ãŸã€‚
ä¸Šã®ç…©é›‘ãªå‡¦ç†ãŒã‚¹ãƒƒã‚­ãƒªã¾ã¨ã¾ã£ã¦ã„ã¾ã™ï¼ï¼

https://github.com/steelydylan/react-embed-devtools

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•

```bash
npm install react-embed-devtools
```

### ä½¿ã„æ–¹

ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§ç°¡å˜ã«ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ï¼
èª¿æŸ»ã—ãŸã„iframeã«å¯¾ã—ã¦ã€`embedChobitsu`ã‚’ä½¿ã£ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èª­ã¿è¾¼ã‚€ã“ã¨ã§ã€å®Ÿéš›ã«ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ãŸæ¤œè¨¼ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ï¼

```tsx
import React from "react";
import { EmbedDevTools, embedChobitsu } from "react-embed-devtools";

const html = `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  ${embedChobitsu()}
  <style>
    h1 {
      color: #333;
      font-size: 32px;
    }
  </style>
</head>
<body>
  <h1>Hello World</h1>
  <script>console.log('Hello World')</script>
</body>
</html>
`;

function App() {
  return (
    <EmbedDevTools
      direction="vertical"
      srcDoc={html}
      style={{ width: "100%", height: "100%" }}
      resizableProps={{
        style: { background: "rgba(0, 0, 0, 0.1)", height: "10px" },
      }}
      devToolsProps={{
        style: { width: "100%", height: "100%" },
      }}
    />
  );
}
```

### æ³¨æ„ç‚¹

::: message alert
iframeã®èª­ã¿è¾¼ã¿å…ˆãŒã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³ã®å ´åˆã€ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ãŒæ­£å¸¸ã«å‹•ä½œã—ãªã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
:::

